Change the SHELL for Bob from bash to Bourne Shell

Bob's password is caleston123

Note: - Normal users can not execute the high-level tasks so add sudo before the command.

sudo chsh -s /bin/sh bob


Create a new environment variable called PROJECT=MERCURY and make it persistent by adding the variable to the ~/.profile file.

Use export PROJECT=MERCURY
and add the value to the .profile by running echo 'export PROJECT=MERCURY' >> /home/bob/.profile

Set an alias called up for the command uptime and make it persistent by adding to ~/.profile file.

 echo "alias up=uptime" >> .profile
 
Update Bob's prompt so that it displays the date as per the format below:

Example: [Wed Apr 22]bob@caleston-lp10:~$
Make sure the change is made persistent.


Update Bob's prompt so that it displays the date as per the format below:

Example: [Wed Apr 22]bob@caleston-lp10:~$
Make sure the change is made persistent.

echo 'PS1="[\d]\u@\h:\w$"' >> ~/.profile


What is the exact version of kernel running in this system?
 uname -r 
cat /etc/os-release 


Which command would you run to print the messages generated by the kernel?

dmesg

How many block devices of type disk are present in the system?

lsblk


Use an rpm command and find out the exact package name for wget installed in this server (centos-lab).

rpm -qa | grep wget


The package for the firefox browser has been downloaded under /home/bob in the centos-lab server.
Try to install it using RPM.


sudo rpm -ivh /home/bob/firefox-68.6.0-1.el7.centos.x86_64.rpm

 (It might fail due to failed dependencies)
 sudo yum install firefox -y
 sudo yum repolist // repo list
 sudo yum provides tcpdump // which package provides tcpdump
 
 
 //Debain distros use dpkg
 
 sudo dpkg -i firefox.deb
 
 
 sudo apt install firefox  // Install alogn with dependencies

sudo apt remove


Create a tarball of the directory called python and compress it using gzip. The compressed tar file should be available at /home/bob/python.tar.gz

tar -cf /home/bob/python.tar /home/bob/reptile/snake/python
gzip python.tar 

There is a compressed file called eaglet.dat.gz located under the eagle directory. Extract it in the same location.

gunzip eaglet.dat.gz


A file called caleston-code has been copied somewhere inside the /opt directory. But, Bob does not remember which directory he saved it in.

Can you find it?

sudo find /opt -name caleston-code

Find the file under /etc directory that contains the string 172.16.238.197. Save the answer using the absolute path in the file /home/bob/ip

sudo grep -ir 172.16.238.197 /etc/ > /home/bob/ip

Create a new file called /home/bob/file_wth_data.txt. This file should have one line of text that says a file in my home directory.

Make use of the redirect operator.

echo "a file in my home directory" > /home/bob/file_wth_data.txt

Run the command python3 /home/bob/my_python_test.py and redirect the standard error to the file /home/bob/py_error.txt
python3 /home/bob/my_python_test.py 2>/home/bob/py_error.txt

Read the file /usr/share/man/man1/tail.1.gz and without extracting it and redirect the contents to a file called /home/bob/pipes
zcat /usr/share/man/man1/tail.1.gz | tee /home/bob/pipes

Create a group called john with the GID 1010. Next create another user called john with UID = 1010, primary group = john and login shell = /bin/sh


groupadd -g 1010 john
useradd -u 1010 -g 1010 -s /bin/sh john


A new directory called sports has been created in your home directory. Inspect it.

ls -ld sports

A new file called soccer has been created under the sports directory.

It has full permissions, update the file so that the group and others only have read and execute permissions.
chmod go-w soccer 
chmod 755 /home/bob/sports/soccer

Now, change the ownership of the file called soccer to the service account called mercury.

chown mercury soccer

We have created another file in the sports directory. Change the ownership for the entire sports directory including all the files inside to the service account mercury.
Try to do this with one single command. Explore the -R recursive flag with the chown command.

chown -R mercury sports


Which port number does the SSH service use by default?
netstat -ntlp | grep ssh
If you run ssh devapp01 in the terminal, which user are you using to connect to the server?
If no user is specified with the ssh command, the connection will be attempted with the logged-in user

password less ssh connection

ssh-keygen -t rsa

Copy the public key to the target server devapp01. Make use of the ssh-copy-id command
ssh-copy-id bob@devapp01
The public key is added to the authorized_keys file under /home/bob/.ssh directory

Finally, copy the file /home/bob/caleston-code.tar.gz from Bob's laptop to the server devapp01. Copy the file to Bob's home directory.
scp /home/bob/caleston-code.tar.gz devapp01:/home/bob


IP tables
------------------------------

sudo apt install iptables

Use the iptables -L command to list the rules.


On devapp01, add an incoming rule permitting SSH and HTTP connection from Bob's Laptop. Bob's Laptop has an IP address of 172.16.238.187
sudo iptables -A INPUT -p TCP -s 172.16.238.187 --dport 22 -j ACCEPT
sudo iptables -A INPUT -p TCP -s 172.16.238.187 --dport 80 -j ACCEPT

Now, lockdown incoming traffic on devapp01. Drop incoming connections from any source on any destination port for any protocol (TCP/UDP). Remember, this rule should be at the bottom of the chain for the SSH and HTTP access from caleston-lp10 to work.
sudo iptables -A INPUT -j DROP  

On devapp01, add an outgoing rule permitting access to port 5432 on devdb01 and HTTP access to caleston-repo-01. Once this is done, block outgoing traffic to any destination on http/https ports from devapp01

Note: caleston-repo-01 has the ip address of 172.16.238.15

sudo iptables -A OUTPUT -p TCP -s 172.16.238.11 --dport 5432 -j ACCEPT
sudo iptables -A OUTPUT -p TCP -s 172.16.238.15 --dport 80 -j ACCEPT
sudo iptables -A OUTPUT -p TCP --dport 80  -j DROP
sudo iptables -A OUTPUT -p TCP --dport 443  -j DROP

Add an OUTPUT rule to the top of the chain which will allow https connection to google.com on devapp01
sudo iptables -I OUTPUT -p TCP -d google.com --dport 443 -j ACCEPT


cron jobs

Which command is used to list all the cronjobs created for a user?
crontab --help

nspect the cronjobs scheduled for bob again. Which command/script is run at 11 minutes past 11 PM every Tuesday?

Inspect the cronjobs scheduled.
The Day of the Week (5th column) should be Tuesday = 2
The hour(2nd column) should be 11 PM = 23
The minute (1st column) should be 11 minutes = 11
This transalates to 11 23 * * 2. The script that runs at this specific schedule is /usr/local/bin/system-identifier.sh

Bonus Hint: Use this handy site to predict a outcome of a Cron configuration:
https://cronjob.xyz/


Schedule a cronjob to run the script /usr/local/bin/last-reboot.sh on the first day of every month at 6 AM.
The script should not run any other day.
crontab -e
0 6 1 * * /usr/local/bin/last-reboot.sh


The script /usr/local/bin/system-debugger.sh was incorrectly scheduled. It should run every half hour at minute 0 and minute 30

Example: 09:00, 09:30, 10:00, 10:30, 11:00, 11:30……so on every half hour.

*/30 * * * * /usr/local/bin/system-debugger.sh


What is the IP address of the DNS Server used in this system?
cat /etc/resolv.conf
Which file is responsible for host file-based DNS resolution?
/etc/hosts
What is the configuration file used for the DNS Server?
/etc/resolv.conf
Change the DNS Server to google's DNS which is 8.8.8.8
Edit the /etc/resolv.conf file and change the nameserver IP to 8.8.8.8
Which order is used currently to resolve an IP address in the system?
Run: grep hosts /etc/nsswitch.conf, since the files precede the dns option, it will first check host file

Change the order to DNS first and then hosts.
Update /etc/nsswitch.conf and change the line to hosts: dns files



What is the default gateway configured in the system?

ip r

However, something seems to be wrong with the network!
Check if you are able to connect to the HTTP port 80 on the server devapp01-web from Bob's laptop?

telnet devapp01-web 80

Inspect the interface eth0 on devapp01, is it UP?

run: ip link and look at the status of the interface starting with eth0
Bring up the eth0 interface
sudo ip link set dev eth0 up

While we are at it, there is also a missing default route on the server devapp01.

Add the default route via eth0 gateway

sudo ip r add default via 172.16.238.1

------
trobuleshooting network
ip link
check dns resolution. Run nslookup servername
check the routes run traceroute 
netstat -an | grep 80 | grep -i listen


What is the status of the sample.service unit?
sudo systemctl status sample.service

Try starting the service
sudo systemctl start sample.service

Why did the service start fail?
sudo journalctl -u sample.service

Update the [Service] section

Set the ExecStart to run the script /bin/bash /root/sample_script.sh.
Once done, start the service.

sudo vi /etc/systemd/system/sample.service
sudo systemctl start sample.service

Enable this service now so that it will be started automatically after a reboot for multi-user.target

sudo systemctl enable sample.service

Now update the service to ensure that it restarts when stopped for any reason.

user Restart=always derivative.

Run: sudo vi /etc/systemd/system/sample.service
Add Restart=always to the Service section.
Save and Exit

Reload the service unit file
sudo systemctl daemon-reload

How would you check the errors encountered earlier when the sample service did not have a valid service section?
journalctl -u sample.service
